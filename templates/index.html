{% extends "base.html" %}
{% block title %}HawkHire{% endblock %}
{% block content %}
{% load staticfiles %}
      <!--   Icon Section   -->
<div class="section">
  <div class="search z-depth-1">
    <div class="col m10 s12">
      <div class="search-bar">
        <form class="search-form">
          <input type="text" id="search" placeholder="Search Keywords"></input>
        </form>
      </div>
    </div>
    <div class="search-params">
      <div class="row">
        <form action="{% url 'home' %}">
          <div class="col m3 s4 param">
            <select name="job_type" id="id_job_type" required>
              <option name="job_type" value="" disabled selected>Job Type</option>
              <option value="Internship">Internship</option>
              <option value="Full-Time">Full-Time</option>
              <option value="Part-Time">Part-Time</option>
            </select>
          </div>
          <div class="col m3 s4 param">
            <select name="location" id="id_location" required>
              <option name="location" value="" disabled selected>Location</option>
              <option value="NewYork">New York</option>
              <option value="SanFrancisco">San Francisco</option>
              <option value="WashingtonDC">Washington, DC</option>
            </select>
          </div>
          <div class="col m3 s4 param">
            <select name="industries" id="id_industries" required>
              <option name="industries" value="" disabled selected>Role</option>
              <option value="Engineering">Engineering</option>
              <option value="Product">Product</option>
              <option value="Business">Business</option>
            </select>
          </div>
          <div class="col m3 s4 clear">
            <a href="{% url 'home' %}">Clear Search</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="center">
  <h6>{{ count }} jobs available</h6>
</div>
<div class="section">
  <div class="results z-depth-1">
    {% for posting in postings %}
    {% if posting.id not in applications %}
    <div class="row result">
      <div class="col m2 s12 company-logo">
        <img class="square-logo" src="{% static posting.company.logo %}">
      </div>
      <div class="col m3 s12">
        <ul class="posting-details">
          <li><strong>{{ posting.company.name }}</strong></li>
          <li>{{ posting.position }}</li>
          <li>{{ posting.location }}</li>
        </ul>
      </div>
      <div class="col m5 s12">
        <p>{{ posting.description|truncatewords:12 }}</p>
      </div>
      <div class="col m2 s12">
        <a href="{% url 'posting_detail' posting.id%}" class="waves-effect waves-light btn-large btn-posting blue">More Info</a>
      </div>
    </div>
    <div class="row block">
    </div>
    {% endif %}
    {% endfor %}
  </div>
</div>


<script>
  $(document).ready(function(){
    var selected = {};
    location.search.substr(1).split("&").forEach(function (pair) {
        if (pair === "") return;
        var parts = pair.split("=");
        selected[parts[0]] = parts[1] &&
        decodeURIComponent(parts[1].replace(/\+/g, " "));
    });
    console.log(selected);
    for (var key in selected) {
      $('option[name='+key+']').removeAttr('selected');
      $('option[value='+selected[key]+']').attr('selected', true);
    };
    $('select').material_select();
    $('select').change(function() {
      var q = $(this).val();
      var base = $(this).attr("name")
      if(String(window.location.href).indexOf('?') > -1){
        var url = window.location.href + "&"+base + "=" + q;
      } else {
        var url = window.location.href + "?"+base + "=" + q;
      }
      $(location).attr('href',url);
    });
    $('input[id=search]').keypress(function(e){
      if (e.which == 13) {
        e.preventDefault();
        var q = $(this).val();
        if(String(window.location.href).indexOf('?') > -1){
          var url = window.location.href + "&"+"q" + "=" + q;
        } else {
          var url = window.location.href + "?"+"q" + "=" + q;
        }
        $(location).attr('href',url);
      }
    });

  });
</script>
{% endblock %}
